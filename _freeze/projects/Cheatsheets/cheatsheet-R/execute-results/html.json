{
  "hash": "30731d8cec0cfdc131c2db92e5284299",
  "result": {
    "markdown": "---\ntitle: \"Cheatsheet for R\"\nauthor: \"Yingying Yu\"\ndate: 2023-12-10\ndescription: Useful packages and their famous functions in data analysis and data management\ncategories: [R, tidyverse]\n---\n\n\n# Introduction\n\nDuring the process of data analysis, especially in **data wrangling** and **data visualization**, we often perform similar workflows to reach our target. For example, some functions within the `tidyverse` are really useful to do exploratory data analysis (EDA). To fit our data to a statistical model, we need to first transform our raw data to a specific form of data frame. We might also have a preferred way to present our graphs from the result. This article summarized some of my routine commands, and this page would be keep updating for the future.\n\nOn the other hand, managing data is quite different from analyzing data, especially if you have a large clinical data set with is continually updating during the research period. In the second part of this page, I put some helpful commands for simple data management.\n\n# Data Analysis\n\n## Data Wrangling\n\n### Package `tidyverse`\n\n::: callout-note\nThe package `tidyverse` included different small packages, below are what I use frequently:\n\n| Package Name | Core Usage                   |\n|--------------|------------------------------|\n| `dplyr`      | Data manipulation            |\n| `tidyr`      | Tidy data                    |\n| `purrr`      | Replace loops                |\n| `stringr`    | Convert strings              |\n| `forcats`    | Handle categorical variables |\n\nMore `tidyverse` packages can be found on this website: <https://www.tidyverse.org/packages/>.\n:::\n\n------------------------------------------------------------------------\n\n### Package `dplyr`\n\nWhen we first uploaded our data, the first instinct to do is look it up, the `glimpse()` function provide the number of rows and columns of the data frame, as well as the types of data of every column. The base R `table()` function can show the number of each kind of a variable.\n\nLet's use the 2020 U.S. Census data for example. `ca_race` contains the household income of different race/ethnicity by counties in California.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nca_race <- readRDS(\"race.RDS\")\nglimpse(ca_race)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 58\nColumns: 9\n$ GEOID     <chr> \"06001\", \"06003\", \"06007\", \"06011\", \"06013\", \"06017\", \"06019…\n$ NAME      <chr> \"Alameda\", \"Alpine\", \"Butte\", \"Colusa\", \"Contra Costa\", \"El …\n$ whiteE    <dbl> 115050, 89583, 57606, 58780, 111149, 82988, 60299, 50559, 50…\n$ blackE    <dbl> 56664, NA, 22302, 14946, 73306, 69519, 39621, 30263, 24107, …\n$ nativeE   <dbl> 82661, 47321, 52734, 85208, 78815, NA, 52511, 32813, 41250, …\n$ asianE    <dbl> 130236, NA, 49375, NA, 121358, 111964, 68274, 38456, 99030, …\n$ islanderE <dbl> 97500, NA, 118667, NA, 90565, 58516, 45595, NA, NA, 73750, 9…\n$ otherE    <dbl> 76546, NA, 48707, 67303, 72866, 69948, 45525, 42094, 41571, …\n$ region    <chr> \"Bay Area\", \"Capital Region\", \"Rest\", \"Capital Region\", \"Bay…\n```\n:::\n\n```{.r .cell-code}\ntable(ca_race$region)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n           Bay Area      Capital Region      Central Valley                Rest \n                  9                   9                   6                  27 \nSouthern California \n                  7 \n```\n:::\n:::\n\n\n::: callout-tip\nOne of the most efficient way of using functions within the `dplyr` package is along with the pipe `%>%`. Since the function names are human-readable and easy to follow, stacking up the functions using pipe make your data wrangling process clean and concise.\n:::\n\n**The most common functions are**\\\n`mutate()`: adds new variables that are functions of existing variables\\\n`filter()`: picks cases based on their values in a variable\\\n`group_by()`: perform any operation by group\\\n`summarise()`: calculate the mean, median, sd, min, max, first, last, n, n_distinct of a variable\\\n`arrange()`: changes the ordering of the rows\\\n`case_when()`: vectorise multiple `if_else()` statements\\\n`na.rm = TRUE`: calculate by removing massing values\n\n\n::: {.cell}\n\n```{.r .cell-code}\nca_race <- ca_race %>% \n  mutate(total = rowSums(select(.,whiteE, blackE, nativeE, asianE, islanderE, otherE), \n                         na.rm = TRUE)) %>%\n  mutate(level = case_when(total < 50000 ~ \"Less than 50000\",\n                           total <= 150000 ~ \"50001 - 150000\",\n                           total <= 300000 ~ \"150001 - 300000\",\n                           total <= 500000 ~ \"300001 - 500000\",\n                           total > 500000 ~ \"More than 500000\",\n                           TRUE ~ \"Rest\"))\nsum_table <- ca_race %>%\n  filter(region != \"Rest\") %>%      \n  group_by(region) %>%\n  summarize(White = mean(whiteE),\n            Black = mean(blackE, na.rm = TRUE),\n            Native = mean(nativeE, na.rm = TRUE),\n            Asian = mean(asianE, na.rm = TRUE),\n            Islander = mean(islanderE, na.rm = TRUE),\n            Other = mean(otherE, na.rm = TRUE)) %>% \n  arrange(region)\nsum_table\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 7\n  region                White  Black Native   Asian Islander  Other\n  <chr>                 <dbl>  <dbl>  <dbl>   <dbl>    <dbl>  <dbl>\n1 Bay Area            114912. 69085  84676  120988    92294  72606.\n2 Capital Region       72706. 58022. 50799.  79919.   60816. 59030.\n3 Central Valley       59379. 45909. 47797.  68488.   88245. 48077.\n4 Southern California  77601. 59083. 64966.  95986.   82545. 60632.\n```\n:::\n:::\n\n\nMore usage of `dyplr` can be found [here](https://github.com/rstudio/cheatsheets/blob/main/data-transformation.pdf)\n\n------------------------------------------------------------------------\n\n### Package `tidyr`\n\n**Common functions:**\\\n`pivot_longer()` and `pivot_wider()`: to converts data between long and wide forms\\\n`complete()`: make implicit missing values explicit\\\n`drop_na()`: make explicit missing values implicit\\\n`fill()`: replace missing values with next/previous value\\\n`replace_na()`: replace missing values with a known value\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_table <- sum_table %>% \n  pivot_longer(cols = c(\"White\", \"Black\", \"Native\", \"Asian\", \"Islander\", \"Other\"),\n               names_to = \"Race\",\n               values_to = \"Value\")\nsum_table\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 24 × 3\n   region         Race       Value\n   <chr>          <chr>      <dbl>\n 1 Bay Area       White    114912.\n 2 Bay Area       Black     69085 \n 3 Bay Area       Native    84676 \n 4 Bay Area       Asian    120988 \n 5 Bay Area       Islander  92294 \n 6 Bay Area       Other     72606.\n 7 Capital Region White     72706.\n 8 Capital Region Black     58022.\n 9 Capital Region Native    50799.\n10 Capital Region Asian     79919.\n# ℹ 14 more rows\n```\n:::\n:::\n\n\nMore usage of `tidyr` can be found [here](https://github.com/rstudio/cheatsheets/blob/main/tidyr.pdf)\n\n------------------------------------------------------------------------\n\n### Package `forcats`\n\n**Common functions:**\\\n`fct_reorder()`: Reordering a factor by another variable\\\n`fct_infreq()`: Reordering a factor by the frequency of values\\\n`fct_relevel()`: Changing the order of a factor by hand\\\n`fct_lump()`: Collapsing the least/most frequent values of a factor into \"other\"\n\n\n::: {.cell}\n\n```{.r .cell-code}\nca_race$level <- fct_relevel(ca_race$level, c(\"More than 500000\",\n                                              \"300001 - 500000\",\n                                              \"150001 - 300000\",\n                                              \"50001 - 150000\",\n                                              \"Less than 50000\"))\nlevels(ca_race$level)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"More than 500000\" \"300001 - 500000\"  \"150001 - 300000\"  \"50001 - 150000\"  \n```\n:::\n:::\n\n\nMore usage of `forcats` can be found [here](https://forcats.tidyverse.org)\n\n------------------------------------------------------------------------\n\n## Data visualization\n\n### Package `ggplot2`\n\nThis is most famous package to visualize data in the R community. Although `ggplot2` is also part of the `tidyverse` package, we put it here for the sake of separate topics.\n\n**Common functions:**\\\n`geom_point()`: adds points to the plot\\\n`geom_line()`: connects points with lines\\\n`geom_histogram()`: creates histograms\\\n`geom_bar()`: creates bar plots\\\n`geom_boxplot()`: generates boxplots\\\n`geom_vline()`: generate reference lines (horizontal, vertical, or diagonal)\\\n`geom_smooth()`: adds a smoothed line to a scatterplot\\\n`facet_wrap()`: facets the plot into multiple panels based on a categorical variable\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_table %>% \n  ggplot(aes(x = Race, y = Value)) +\n  facet_wrap(~ region, nrow = 2) +\n  geom_bar(stat = \"Identity\", fill = \"#98103E\") +\n  labs(title = \"Household income race and region in California\",\n       subtitle = \"2016-2020 American Community Survey\",\n       caption = \"Source data from the U.S. Census Bureau\",\n       x = \"Categories\",\n       y = \"Values\") + \n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](cheatsheet-R_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nMore usage of `ggplot2` can be found [here](https://github.com/rstudio/cheatsheets/blob/main/data-visualization.pdf)\n\n-------------------\n\n# Data Management\n\nIn the actual data management process over time in a typical research study, you want to create multiple R script files. Each R script file will modify the previous version of the data file and then save a newly named version. This process allows you to easily recreate your work and to re-run your data management steps to an exact endpoint.  \n\n## Review data\n\n`names(data)`: Show the column names    \n`str(data)`: Show the structure of our data    \n`head(data,2)`: Show the first 2 rows of data     \n`tail(data,2)`: Show the last 2 rows of data     \n`nrow(data)`: Show the number of rows     \n`ncol(data)`: Show the number of columns    \n`object.size(data)`: Size of the dataset in memory     \n\nIn the package `skimr`, there is a function `skim` showing the structure and details of data \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(skimr)\nskim(ca_race)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |        |\n|:------------------------|:-------|\n|Name                     |ca_race |\n|Number of rows           |58      |\n|Number of columns        |11      |\n|_______________________  |        |\n|Column type frequency:   |        |\n|character                |3       |\n|factor                   |1       |\n|numeric                  |7       |\n|________________________ |        |\n|Group variables          |None    |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|GEOID         |         0|             1|   5|   5|     0|       58|          0|\n|NAME          |         0|             1|   4|  15|     0|       58|          0|\n|region        |         0|             1|   4|  19|     0|        5|          0|\n\n\n**Variable type: factor**\n\n|skim_variable | n_missing| complete_rate|ordered | n_unique|top_counts                       |\n|:-------------|---------:|-------------:|:-------|--------:|:--------------------------------|\n|level         |         0|             1|FALSE   |        4|300: 30, 150: 14, Mor: 7, 500: 7 |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|      mean|        sd|    p0|       p25|      p50|       p75|   p100|hist  |\n|:-------------|---------:|-------------:|---------:|---------:|-----:|---------:|--------:|---------:|------:|:-----|\n|whiteE        |         0|          1.00|  73867.97|  23435.16| 41080|  57731.75|  66382.5|  86247.25| 146043|▇▆▃▁▁ |\n|blackE        |        12|          0.79|  61877.83|  21661.67| 14946|  45840.00|  66883.5|  78232.25| 118322|▃▇▇▆▁ |\n|nativeE       |         8|          0.86|  57756.06|  20306.70| 22961|  41673.00|  53716.0|  72275.50| 101023|▅▇▅▅▃ |\n|asianE        |         9|          0.84|  86131.61|  27743.71| 38456|  67396.00|  80530.0| 101563.00| 155757|▂▇▃▃▁ |\n|islanderE     |        28|          0.52|  77819.13|  22980.83| 26776|  60479.75|  79714.0|  96130.25| 120275|▁▆▅▇▂ |\n|otherE        |         6|          0.90|  59723.19|  13598.26| 26711|  49052.75|  58672.0|  69996.50|  93750|▁▇▇▆▁ |\n|total         |         0|          1.00| 339295.76| 143907.43| 52034| 252112.25| 353818.5| 433545.00| 639623|▃▃▇▅▂ |\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n## Manipulating records\n \n`distinct()`: remove duplicates     \n`dmy()`: convert date strings to dates, can also be `ymd()` `ydm()`, and so on    \n`bind_rows()`: bind (append) two data together by rows    \n`left-join()`: merge two data together by columns    \n`replace()`: use it within mutate() to change specific data values    \n`factor()`: categorize the data using levels and labels     \n`cut()`: breaks the given vector into the intervals specified in \"breaks\"     \n\n::: {.cell}\n\n```{.r .cell-code}\n# Bind baseline data together\nbl_data <- bind_rows(bl_site1_raw, bl_site2_raw)\n# Bind follow-up data together\nf_data <- bind_rows(f_site1_raw, f_site2_raw)\n# Join baseline and followup data\nall_data <- left_join(bl_data, f_data, by=c(\"siteid\"=\"siteid\",\"hhid\"=\"hhid\",\"childid\"=\"childid\"))\n\n# Add new column using mutate() for record ID with concatenated site/hh/childid\n# Re-order the columns using select(). The everything() is all unspecified columns.\nall_data <- all_data |> \n  mutate(record_id = paste0(siteid,hhid,childid)) |>  \n  select(record_id,everything())\n# create factor\nall_data$siteid <- factor(all_data$siteid,\n                   levels=c(1,2),\n                   labels=c(\"JHU\",\"UMD\"))\n# cut a variable\nall_data$weight_cut <- cut(all_data$weight,breaks=c(0,10,Inf), labels=c(\"low\",\"hi\"))\n# update a record\nall_data <- all_data |> \n  mutate(reltns = replace(reltns, record_id == 156431, 2))\n\nall_data[all_data$record_id == 156431,]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  record_id siteid hhid childid visitdate.x gender       dob visitdate.y reltns\n1    156431    JHU  564      31   24-Sep-06      0 24-Apr-04   21-Sep-07      2\n  bodtmp appeti fever cough breath weight lengt1 lengt2 lengt3 weight_cut\n1   97.8      3     0     1      0   14.6   98.6   98.6   98.5         hi\n```\n:::\n:::\n\n\n## Exporting data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Write a csv file\nwrite.csv(all_data, file=\"data_out.csv\", row.names = FALSE)\n# Save it in rda or RDS format\nsave(all_data, file = \"tuesdata_tornados.rda\")\n# Save the workspace with the data\nsave.image(file=\"data01.RData\")\n```\n:::\n",
    "supporting": [
      "cheatsheet-R_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}